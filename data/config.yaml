# Voter Transition Study Configuration
# Central configuration for cities, data processing, and PyMC parameters

# Target cities for city-level transition matrix analysis
cities:
  target_cities:
    - ashdod
    - beit shemesh
    - elad
    - bnei brak
    - jerusalem
    - modi'in illit

# Data processing settings
data:
  # Homogenic filtering settings
  homogenic_filtering:
    enabled: true
    threshold: 0.75  # >75% Haredi party votes (Shas + Agudat Israel)

  # Elections to process (Knesset election numbers)
  elections:
    - 18
    - 19
    - 20
    - 21
    - 22
    - 23
    - 24
    - 25

  # Election pairs for transition analysis
  transition_pairs:
    - kn18_19
    - kn19_20
    - kn20_21
    - kn21_22
    - kn22_23
    - kn23_24
    - kn24_25

# PyMC model parameters
model:
  # Prior parameters for simplified hierarchical model (tighter priors for stability)
  logistic_normal:
    diag_bias_mean: 2.0        # Mean for diagonal bias (loyalty) parameter
    diag_bias_sigma: 0.3       # Standard deviation for diagonal bias parameter
    sigma_country: 0.5         # Scale for country-level logit variation (tighter)
    sigma_D: 0.3              # Scale for shared deviation pattern matrix (tighter)
    delta_scale: 0.5          # Scale for city-specific deviation scalars (tighter)

  # Temporal priors configuration (use previous transition as prior)
  temporal_priors:
    enabled: true                 # If true, use previous pair's posterior as prior
    center: mean                  # mean|median centers for priors
    # Innovation scales for how tightly to trust previous estimates (tighter)
    innovation:
      diag_bias_sigma: 0.3        # Prior sd around previous diag_bias (tighter)
      Z_country_sigma: 0.5        # Prior sd for Z_country logits (tighter)
      D_sigma: 0.3               # Prior sd for deviation pattern D (tighter)
    carryover_city_level: false   # City scalars (delta_city) are re-initialized each election

  parameterization:
    matrix_convention: columns_from_rows_to   # columns = "from", rows = "to"; keep q = p1 @ M.T
    enforce_category_order: true              # validate x1/x2 category order before modeling
    plotting_rows: to                         # when plotting heatmaps, rows=to, cols=from
    plotting_cols: from

  # MCMC sampling parameters (improved for convergence)
  sampling:
    draws: 3000                 # Posterior samples per chain (increased)
    tune: 3000                  # Tuning samples per chain (increased)
    chains: 4                   # Number of parallel chains
    target_accept: 0.95         # Target acceptance rate for NUTS (slightly lower)
    max_treedepth: 12           # Reduced for stability
    init: "adapt_diag"          # Simplified initialization

  # Convergence diagnostics thresholds
  diagnostics:
    max_rhat: 1.01             # Maximum R-hat for convergence
    min_ess_bulk: 400          # Minimum bulk ESS
    min_ess_tail: 400          # Minimum tail ESS

# Party categories for transition modeling
categories:
  - shas                       # Shas party (שס)
  - agudat_israel             # Agudat Israel (ג)
  - other                     # All other parties combined
  - abstained                 # Non-voters + invalid votes

# File paths and naming conventions
paths:
  # Data directories
  raw_data: "data/raw"
  interim_data: "data/interim"
  processed_data: "data/processed"
  external_data: "data/external"

  # External mapping files
  columns_mapping: "data/external/columns.csv"
  columns_extended: "data/external/columns_extended.csv"
  cities_mapping: "data/external/israeli_cities_hebrew_english.csv"

  # Output directories
  transitions_dir: "data/processed/transitions"
  logs_dir: "data/processed/logs"