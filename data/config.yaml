# Voter Transition Study Configuration
# Central configuration for cities, data processing, and PyMC parameters

# Target cities for city-level transition matrix analysis
cities:
  target_cities:
    - ashdod
    - beit shemesh
    - elad
    - bnei brak
    - jerusalem
    - modi'in illit

# Data processing settings
data:
  # Homogenic filtering settings
  homogenic_filtering:
    enabled: true
    threshold: 0.75  # >75% Haredi party votes (Shas + Agudat Israel)

  # Elections to process (Knesset election numbers)
  elections:
    - 19
    - 20
    - 21
    - 22
    - 23
    - 24
    - 25

  # Election pairs for transition analysis
  transition_pairs:
    - kn19_20
    - kn20_21
    - kn21_22
    - kn22_23
    - kn23_24
    - kn24_25

# PyMC model parameters
model:
  # Prior parameters for logistic-normal hierarchical model
  logistic_normal:
    diag_bias_mean: 3.0        # Mean for diagonal bias (loyalty) parameter
    diag_bias_sigma: 0.5       # Standard deviation for diagonal bias parameter
    sigma_country: 1.0         # Scale for country-level logit variation
    sigma_city: 0.5           # Scale for city-level logit deviations
    nu_scale: 5.0             # Scale parameter for Student-t degrees of freedom

  # Temporal priors configuration (use previous transition as prior)
  temporal_priors:
    enabled: true                 # If true, use previous pair's posterior as prior
    center: mean                  # mean|median centers for priors
    # Innovation scales for how tightly to trust previous estimates
    innovation:
      diag_bias_sigma: 0.5        # Prior sd around previous diag_bias
      Z_country_sigma: 1.0        # Prior sd for Z_country logits
      Z_city_sigma: 0.7           # Prior sd for city logits (if available)
      log_phi_sigma: 1.0          # Prior sd for log_phi
    carryover_city_level: true    # If true, carry city-level priors when available

  parameterization:
    matrix_convention: columns_from_rows_to   # columns = "from", rows = "to"; keep q = p1 @ M.T
    enforce_category_order: true              # validate x1/x2 category order before modeling
    plotting_rows: to                         # when plotting heatmaps, rows=to, cols=from
    plotting_cols: from

  # MCMC sampling parameters
  sampling:
    draws: 1500                 # Posterior samples per chain
    tune: 1500                  # Tuning samples per chain
    chains: 4                   # Number of parallel chains
    target_accept: 0.98          # Target acceptance rate for NUTS
    max_treedepth: 15
    random_seed: 42             # Reproducibility seed
    init: "jitter+adapt_diag"

  # Convergence diagnostics thresholds
  diagnostics:
    max_rhat: 1.01             # Maximum R-hat for convergence
    min_ess_bulk: 400          # Minimum bulk ESS
    min_ess_tail: 400          # Minimum tail ESS

# Party categories for transition modeling
categories:
  - shas                       # Shas party (שס)
  - agudat_israel             # Agudat Israel (ג)
  - other                     # All other parties combined
  - abstained                 # Non-voters + invalid votes

# File paths and naming conventions
paths:
  # Data directories
  raw_data: "data/raw"
  interim_data: "data/interim"
  processed_data: "data/processed"
  external_data: "data/external"

  # External mapping files
  columns_mapping: "data/external/columns.csv"
  columns_extended: "data/external/columns_extended.csv"
  cities_mapping: "data/external/israeli_cities_hebrew_english.csv"

  # Output directories
  transitions_dir: "data/processed/transitions"
  logs_dir: "data/processed/logs"